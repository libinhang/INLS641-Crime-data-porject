<!DOCTYPE html>
<html lang="en">
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/d3-geo-projection@4"></script>
<script src="js/Arrests_made_map.js"></script>
<script src="js/Incident_report_map.js"></script>
<script src="js/bar_chart.js"></script>
<script src="js/pie_chart.js"></script>
<script src="https://unpkg.com/topojson@3"></script>

<link type="text/css" rel="Stylesheet" href="http://code.jquery.com/ui/1.8.23/themes/smoothness/jquery-ui.css"/>
<script type="text/javascript" src="http://code.jquery.com/jquery-3.6.1.js"></script>
<script type="text/javascript" src="http://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Crime data project</title>
    <link rel="stylesheet" href="css/map.css">
</head>

<body>
<div id="project" class="container">
    <div id="title">
        <h2><span id="map_title">Incident reports in Chapel Hill</span>
            <select class="btn btn-default dropdown-toggle" onchange="mapChange(this.options[this.selectedIndex].value);">
                <option value="Incident_report">Incident Report Map</option>
                <option value="Arrest_made">Arrest Made Map</option>
            </select>
        </h2>
    </div>
    <div id="filter_bar">
        <h3><span id="cata_info">Crime type</span>:
            <div class="btn-group">
                <div class="dropdown">
                    <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">All Crimes
                       </button>
                    <ul class="dropdown-menu">
                        <li ><a class="main_cata" tabindex="-1" id="All" onclick="filterData(this.className,this.id);">Show All</a></li>
                        <li class="divider"></li>
                        <li ><a class="main_cata" tabindex="-1" id="Against Minors" onclick="filterData(this.className,this.id);">Against Minors</a></li>
                        <li><a class="main_cata" tabindex="-1" id="Fraud" onclick="filterData(this.className,this.id);">Fraud</a></li>
                        <li><a class="main_cata" tabindex="-1" id="Obstruction" onclick="filterData(this.className,this.id);">Obstruction</a></li>
                        <li><a class="main_cata" tabindex="-1" id="Property" onclick="filterData(this.className,this.id);">Property</a></li>
                        <li><a class="main_cata" tabindex="-1" id="Theft" onclick="filterData(this.className,this.id);">Theft</a></li>
                        <li><a class="main_cata" tabindex="-1" id="Vehicle" onclick="filterData(this.className,this.id);">Vehicle</a></li>
                        <li><a class="main_cata" tabindex="-1" id="Weapons" onclick="filterData(this.className,this.id);">Weapons</a></li>
                        <li class="divider"></li>
                        <li class="dropdown-submenu">
                            <a class="cata" tabindex="-1">Alcohol & Drugs<span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li><a class="all_subcata" tabindex="-1" id="Alcohol/Drugs" onclick="filterData(this.className,this.id);">All</a></li>
                                <li><a class="sub_cata" tabindex="-1" id="Alcohol" onclick="filterData(this.className,this.id);">Alcohol</a></li>
                                <li><a class="sub_cata" tabindex="-1" id="Drugs" onclick="filterData(this.className,this.id);">Drugs</a></li>
                                <li><a class="sub_cata" tabindex="-1" id="Marijuana" onclick="filterData(this.className,this.id);">Marijuana</a></li>
                            </ul>
                        </li>
                        <li class="dropdown-submenu">
                            <a class="cata" tabindex="-1">Violent<span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li><a class="all_subcata" tabindex="-1" id="Violent" onclick="filterData(this.className,this.id);">All</a></li>
                                <li><a class="sub_cata" tabindex="-1" id="Assault" onclick="filterData(this.className,this.id);">Assault</a></li>
                                <li><a class="sub_cata" tabindex="-1" id="Domestic Violence" onclick="filterData(this.className,this.id);">Domestic Violence</a></li>
                                <li><a class="sub_cata" tabindex="-1" id="Harassment" onclick="filterData(this.className,this.id);">Harassment</a></li>
                                <li><a class="sub_cata" tabindex="-1" id="Homicide" onclick="filterData(this.className,this.id);">Homicide</a></li>
                                <li><a class="sub_cata" tabindex="-1" id="Kidnapping" onclick="filterData(this.className,this.id);">Kidnapping</a></li>
                                <li><a class="sub_cata" tabindex="-1" id="Sexual Offense" onclick="filterData(this.className,this.id);">Sexual Offense</a></li>
                            </ul>
                        </li>
                        <li class="dropdown-submenu">
                            <a class="cata" tabindex="-1">Other<span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li><a class="all_subcata" tabindex="-1" id="Others" onclick="filterData(this.className,this.id);">All</a></li>
                                <li><a class="sub_cata" tabindex="-1" id="Aiding & Abetting" onclick="filterData(this.className,this.id);">Aiding & Abetting</a></li>
                                <li><a class="sub_cata" tabindex="-1" id="Animals" onclick="filterData(this.className,this.id);">Animals</a></li>
                                <li><a class="sub_cata" tabindex="-1" id="Conspiracy" onclick="filterData(this.className,this.id);">Conspiracy</a></li>
                                <li><a class="sub_cata" tabindex="-1" id="Lower-Level" onclick="filterData(this.className,this.id);">Lower-Level</a></li>
                                <li><a class="sub_cata" tabindex="-1" id="Other" onclick="filterData(this.className,this.id);">Other</a></li>
                                <li><a class="sub_cata" tabindex="-1" id="Warrants/Summons" onclick="filterData(this.className,this.id);">Warrants/Summons</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </h3>
    </div>
        </h3>
    </div>
    <div>
        <svg id="Imap"></svg>
    </div>
    <div id="hidden">
        <div class="container-fluid">
        <div class="row">
            <div class="col">
                <svg id="Amap"></svg>
            </div>
            <div id="multi_charts" class="col">
                <div class="col">
                <svg id="bar_chart"></svg>
                </div>
                <div class="col">
                    <div class="row">
                        <div class="col">
                            <svg id="pie_chart_one"></svg>
                        </div>
                        <div class="col">
                            <svg id="pie_chart_two"></svg>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>
        <div class="container">
                <span id="description"></span>
            <br>
            <br>
            <div class="column" id="timeline" >
                <input type="range" class="form-range" id="time_range" value="2021" min="2010" max="2021" step="1" list="tickmarks"/>
            </div>
            <div class="column">
            <datalist id="tickmarks">
                <option value="2009" label="2009"></option>
                <option value="2010" label="2010"></option>
                <option value="2011" label="2011"></option>
                <option value="2012" label="2012"></option>
                <option value="2013" label="2013"></option>
                <option value="2014" label="2014"></option>
                <option value="2015" label="2015"></option>
                <option value="2016" label="2016"></option>
                <option value="2017" label="2017"></option>
                <option value="2018" label="2018"></option>
                <option value="2019" label="2019"></option>
                <option value="2020" label="2020"></option>
                <option value="2021" label="2021"></option>
            </datalist>
            </div>
            <div id="timer">
                <button type="button" class="btn btn-info" id="play-button" onclick="play()"><span>Time Series Data</span></button>
            </div>
        </div>
    </div>
</div>
<span id="date" style="display: none"></span>
<script>

    let i = document.getElementById("Imap")
    let f = document.getElementById("filter_bar")
    let h = document.getElementById("hidden")

    let incidentMap = new IRmap("Imap")
    let arrestMap = new AMmap("Amap");
    let bar_chart = new Bar_chart("bar_chart");
    let pie_chart = new Pie_chart("pie_chart_one","pie_chart_two");

    $(document).ready(function(){
        $('.dropdown-submenu a.cata').on("click", function(e){
            $(this).next('ul').toggle();
            e.stopPropagation();
            e.preventDefault();
        });
    });

    $(document).on('input', '#time_range', function() {
        arrestMap.render(this.className,parseInt($(this).val()));
        bar_chart.render(parseInt($(this).val()))
        pie_chart.render("time",parseInt($(this).val()))
    });

    function play(){
        $("input[type=range]").val(2009)
        const myInterval = setInterval(play_timer,1000);
        function play_timer(){
            if($("input[type=range]").val()==2021){
                clearInterval(myInterval);
            }else{
                let value = parseInt($("input[type=range]").val())
                value++
                $("input[type=range]").val(value)
                arrestMap.render("form-range",value)
                bar_chart.render(value)
                pie_chart.render("time",value)
            }
        }
    }

    function filterData(type,_subs){
        document.getElementById("cata_info").innerHTML = _subs
        document.getElementById("time_range").value = 2021
        arrestMap.render(type,_subs);
        pie_chart.render("filter",_subs);
    }
    function mapChange(map_type){
        if(map_type == "Incident_report"){
            i.style.display = 'block'
            f.style.display = 'none'
            h.style.display = 'none'
            document.getElementById("map_title").innerHTML = "Incident reports in Chapel Hill "
        }else if(map_type == "Arrest_made") {
            i.style.display = 'none'
            h.style.display = 'block'
            f.style.display = 'block'
            bar_chart.render(2021);
            document.getElementById("map_title").innerHTML = "Police arrest made in Chapel Hill"
            arrestMap.render("main_cata","All");
            pie_chart.render("filter","All");
        }
    }
    incidentMap.loadAndPrepare()
    arrestMap.render("main_cata","All")
    pie_chart.render("filter","All")
</script>
</body>
</html>